<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='ç”µè„‘,ç”µè„‘è®²è§£,ç”µè„‘æŠ€æœ¯,ç¼–ç¨‹,ç”µè„‘æ•…éšœç»´ä¿®Javaï¼Œä½ å‘Šè¯‰æˆ‘ fail-fast æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>é¦–é¡µ</a></li>
</div><div onclick='hidden1()' >åˆ†äº«</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Javaï¼Œä½ å‘Šè¯‰æˆ‘ fail-fast æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</center></div><div class='banquan'>åŸæ–‡å‡ºå¤„:æœ¬æ–‡ç”±åšå®¢å›­åšä¸»æ²‰é»˜ç‹äºŒæä¾›ã€‚<br/>
åŸæ–‡è¿æ¥:https://www.cnblogs.com/qing-gee/p/11909576.html</div><br>
    <p>æœ¬ç¯‡æˆ‘ä»¬æ¥èŠèŠ Java çš„ fail-fast æœºåˆ¶ï¼Œæ–‡å­—ä¸€å¦‚æ—¢å¾€çš„æœ‰è¶£å“¦ã€‚</p>
<!--more-->
<h3 id="å‰è¨€">01ã€å‰è¨€</h3>
<p>è¯´èµ·æ¥çœŸç‰¹ä¹ˆæƒ­æ„§ï¼šåå¹´ IT è€å…µï¼ŒJava èœé¸Ÿä¸€æšã€‚ä»Šå¤©æˆ‘æ‰äº†è§£åˆ° Java è¿˜æœ‰ fail-fast ä¸€è¯´ã€‚ä¸å¾—ä¸æ„Ÿæ…¨å•Šï¼Œå­¦ä¹ çœŸçš„æ˜¯æ²¡æœ‰æ­¢å¢ƒã€‚åªè¦è‚¯å­¦ï¼Œå°±ä¼šæœ‰å·¨å¤šå·¨å¤šåˆ«äººçœ¼ä¸­çš„â€œæ—§â€çŸ¥è¯†æ¶Œç°å‡ºæ¥ï¼Œå¹¶ä¸”åœ¨æˆ‘è¿™å…¨æ˜¯æ–°çš„ã€‚</p>
<p>èƒ½æ€ä¹ˆåŠå‘¢ï¼Ÿé™¤äº†ç¾æ„§ï¼Œå°±åªèƒ½èµ¶ç´§å…¨èº«å¿ƒåœ°æŠ•å…¥å­¦ä¹ ï¼ŒæŠŠè¿™äº›çŸ¥è¯†æŒæ¡ã€‚</p>
<p>ä¸ºäº†é•‡æ¥¼ï¼Œå¿…é¡»æ¬ä¸€æ®µè‹±æ–‡æ¥è§£é‡Šä¸€ä¸‹ fail-fastã€‚</p>
<blockquote>
<p>In systems design, a fail-fast system is one which immediately reports at its interface any condition that is likely to indicate a failure. Fail-fast systems are usually designed to stop normal operation rather than attempt to continue a possibly flawed process. Such designs often check the system's state at several points in an operation, so any failures can be detected early. The responsibility of a fail-fast module is detecting errors, then letting the next-highest level of the system handle them.</p>
</blockquote>
<p>å¤§å®¶ä¸å«Œå¼ƒçš„è¯ï¼Œæˆ‘å°±ç”¨è¹©è„šçš„è‹±è¯­èƒ½åŠ›ç¿»è¯‘ä¸€ä¸‹ã€‚æŸåœºæˆ˜å½¹å½“ä¸­ï¼Œæ”¿å§”å‘ç°å¸ä»¤å‘˜åœ¨ä¹±æŒ‡æŒ¥çš„è¯ï¼Œå°±ç«‹é©¬æŠ¥å‘Šç»™æƒé™æ›´é«˜çš„ä¸­å¤®å†›å§”â€”â€”è¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°é¿å…æ›´ä¸¥é‡çš„åæœå‡ºç°ã€‚å½“ç„¶äº†ï¼Œå¦‚æœå¸ä»¤å‘˜æ˜¯æäº‘é¾™çš„è¯ï¼ŒæŠ¥å‘Šä¹Ÿæ²¡å•¥ç”¨ã€‚</p>
<p>ä¸è¿‡ï¼ŒJava çš„ä¸–ç•Œé‡Œä¸å­˜åœ¨æäº‘é¾™ã€‚fail-fast æ‰®æ¼”çš„å°±æ˜¯æ”¿å§”çš„è§’è‰²ï¼Œä¸€æ—¦æŠ¥å‘Šç»™ä¸Šçº§ï¼Œåé¢çš„è¡ŒåŠ¨å°±åˆ«æƒ³æ‰§è¡Œã€‚</p>
<p>æ€ä¹ˆå’Œä»£ç å…³è”èµ·æ¥å‘¢ï¼Ÿçœ‹ä¸‹é¢è¿™æ®µä»£ç ã€‚</p>
<pre><code><code>public void test(Wanger wanger) {   
    if (wanger == null) {
        throw new RuntimeException(&quot;wanger ä¸èƒ½ä¸ºç©º&quot;);
    }
    
    System.out.println(wanger.toString());
}</code></code></pre>
<p>ä¸€æ—¦æ£€æµ‹åˆ° wanger ä¸º nullï¼Œå°±ç«‹é©¬æŠ›å‡ºå¼‚å¸¸ï¼Œè®©è°ƒç”¨è€…æ¥å†³å®šè¿™ç§æƒ…å†µä¸‹è¯¥æ€ä¹ˆå¤„ç†ï¼Œä¸‹ä¸€æ­¥ <code>wanger.toString()</code> å°±ä¸ä¼šæ‰§è¡Œäº†â€”â€”é¿å…æ›´ä¸¥é‡çš„é”™è¯¯å‡ºç°ï¼Œè¿™æ®µä»£ç ç”±äºå¤ªè¿‡ç®€å•ï¼Œä½“ç°ä¸å‡ºæ¥ï¼Œåé¢ä¼šè®²åˆ°ã€‚</p>
<p>ç§ï¼Œfail-fast å°±æ˜¯è¿™ä¸ªé¬¼ï¼Œæ²¡ä»€ä¹ˆç¥ç§˜çš„ã€‚å¦‚æœå¤§å®¶æºç çœ‹å¾—æ¯”è¾ƒå¤šçš„è¯ï¼Œè¿™ç§ä¾‹å­å¤šå¾—å°±åƒæ—…æ¸¸é«˜å³°æœŸçš„äººå¤´ã€‚</p>
<p>ç„¶åå‘¢ï¼Œæ²¡äº†ï¼Ÿä¸‰ç§’é’Ÿï¼Œåˆ«ç€æ€¥ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚</p>
<h3 id="for-each-ä¸­é›†åˆçš„-remove-æ“ä½œ">02ã€for each ä¸­é›†åˆçš„ remove æ“ä½œ</h3>
<p>å¾ˆé•¿ä¸€æ®µæ—¶é—´é‡Œï¼Œ<a href="https://mp.weixin.qq.com/s/feoOINGSyivBO8Z1gaQVOA">æˆ‘</a>éƒ½ä¸æ˜ç™½ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ <code>for each</code> å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ removeã€‚ä»Šå¤©æˆ‘ä»¬å°±æ¥å€Ÿæœºæ¥ä½“éªŒä¸€æŠŠã€‚</p>
<pre><code><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);

for (String str : list) {
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        list.remove(str);
    }
}

System.out.println(list);</code></code></pre>
<p>è¿™æ®µä»£ç çœ‹èµ·æ¥æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œä½†è¿è¡Œèµ·æ¥å°±ç³Ÿç³•äº†ã€‚</p>
<pre><code><code>Exception in thread &quot;main&quot; java.util.ConcurrentModificationException
    at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:909)
    at java.util.ArrayList$Itr.next(ArrayList.java:859)
    at com.cmower.java_demo.str.Cmower3.main(Cmower3.java:14)</code></code></pre>
<p>ä¸ºæ¯›å‘¢ï¼Ÿ</p>
<h3 id="åˆ†æé—®é¢˜çš„æ€æ‰‹é”">03ã€åˆ†æé—®é¢˜çš„æ€æ‰‹é”</h3>
<p>è¿™æ—¶å€™å°±åªèƒ½çœ‹æºç äº†ï¼ŒArrayList.java çš„ 909 è¡Œä»£ç æ˜¯è¿™æ ·çš„ã€‚</p>
<pre><code><code>final void checkForComodification() {
    if (modCount != expectedModCount)
        throw new ConcurrentModificationException();
}</code></code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œremove çš„æ—¶å€™æ‰§è¡Œäº† <code>checkForComodification</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯¹ modCount å’Œ expectedModCount è¿›è¡Œäº†æ¯”è¾ƒï¼Œå‘ç°ä¸¤è€…ä¸ç­‰ï¼Œå°±æŠ›å‡ºäº† <code>ConcurrentModificationException</code> å¼‚å¸¸ã€‚</p>
<p>å¯ä¸ºä»€ä¹ˆä¼šæ‰§è¡Œ <code>checkForComodification</code> æ–¹æ³•å‘¢ï¼Ÿè¿™å°±éœ€è¦åç¼–è¯‘ä¸€ä¸‹ <code>for each</code> é‚£æ®µä»£ç äº†ã€‚</p>
<pre><code><code>List&lt;String&gt; list = new ArrayList();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);
Iterator var3 = list.iterator();

while (var3.hasNext()) {
    String str = (String) var3.next();
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        list.remove(str);
    }
}

System.out.println(list);</code></code></pre>
<p>åŸæ¥ <code>for each</code> æ˜¯é€šè¿‡è¿­ä»£å™¨ Iterator é…åˆ while å¾ªç¯å®ç°çš„ã€‚</p>
<p>1ï¼‰<code>ArrayList.iterator()</code> è¿”å›çš„ Iterator å…¶å®æ˜¯ ArrayList çš„ä¸€ä¸ªå†…éƒ¨ç±» Itrã€‚</p>
<pre><code><code>public Iterator&lt;E&gt; iterator() {
    return new Itr();
}</code></code></pre>
<p>Itr å®ç°äº† Iterator æ¥å£ã€‚</p>
<pre><code><code>private class Itr implements Iterator&lt;E&gt; {
    int cursor;       // index of next element to return
    int lastRet = -1; // index of last element returned; -1 if no such
    int expectedModCount = modCount;

    Itr() {}

    public boolean hasNext() {
        return cursor != size;
    }

    @SuppressWarnings(&quot;unchecked&quot;)
    public E next() {
        checkForComodification();
        int i = cursor;
        Object[] elementData = ArrayList.this.elementData;
        if (i &gt;= elementData.length)
            throw new ConcurrentModificationException();
        cursor = i + 1;
        return (E) elementData[lastRet = i];
    }
}</code></code></pre>
<p>ä¹Ÿå°±æ˜¯è¯´ <code>new Itr()</code> çš„æ—¶å€™ expectedModCount è¢«èµ‹å€¼ä¸º modCountï¼Œè€Œ modCount æ˜¯ List çš„ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œè¡¨ç¤ºé›†åˆè¢«ä¿®æ”¹çš„æ¬¡æ•°ã€‚ç”±äº list æ­¤å‰æ‰§è¡Œäº† 3 æ¬¡ add æ–¹æ³•ï¼Œæ‰€ä»¥ modCount çš„å€¼ä¸º 3ï¼›expectedModCount çš„å€¼ä¹Ÿä¸º 3ã€‚</p>
<p>å¯å½“æ‰§è¡Œ <code>list.remove(str)</code> åï¼ŒmodCount çš„å€¼å˜æˆäº† 4ã€‚</p>
<pre><code><code>private void fastRemove(int index) {
    modCount++;
    int numMoved = size - index - 1;
    if (numMoved &gt; 0)
        System.arraycopy(elementData, index+1, elementData, index,
                         numMoved);
    elementData[--size] = null; // clear to let GC do its work
}</code></code></pre>
<p>æ³¨ï¼šremove æ–¹æ³•å†…éƒ¨è°ƒç”¨äº† fastRemove æ–¹æ³•ã€‚</p>
<p>ä¸‹ä¸€æ¬¡å¾ªç¯æ‰§è¡Œåˆ° <code>String str = (String) var3.next();</code> çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨ <code>checkForComodification</code> æ–¹æ³•ï¼Œæ­¤æ—¶ä¸€ä¸ªä¸º 3ï¼Œä¸€ä¸ªä¸º 4ï¼Œå°±åªå¥½æŠ›å‡ºå¼‚å¸¸ ConcurrentModificationException äº†ã€‚</p>
<p>ä¸ä¿¡ï¼Œå¯ä»¥ç›´æ¥åœ¨ ArrayList ç±»çš„ 909 è¡Œæ‰“ä¸ªæ–­ç‚¹ debug ä¸€ä¸‹ã€‚</p>
<p><img src="./images/Javaï¼Œä½ å‘Šè¯‰æˆ‘ fail-fast æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ0.png" /></p>
<p>çœŸçš„è€¶ï¼Œä¸€ä¸ªæ˜¯ 4 ä¸€ä¸ªæ˜¯ 3ã€‚</p>
<p><strong>æ€»ç»“ä¸€ä¸‹</strong>ã€‚åœ¨ <code>for each</code> å¾ªç¯ä¸­ï¼Œé›†åˆéå†å…¶å®æ˜¯é€šè¿‡è¿­ä»£å™¨ Iterator é…åˆ while å¾ªç¯å®ç°çš„ï¼Œä½†æ˜¯å…ƒç´ çš„ remove å´ç›´æ¥ä½¿ç”¨çš„é›†åˆç±»è‡ªèº«çš„æ–¹æ³•ã€‚è¿™å°±å¯¼è‡´ Iterator åœ¨éå†çš„æ—¶å€™ï¼Œä¼šå‘ç°å…ƒç´ åœ¨è‡ªå·±ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹è¢«ä¿®æ”¹äº†ï¼Œå®ƒè§‰å¾—å¾ˆéš¾æ¥å—ï¼Œå°±æŠ›å‡ºäº†å¼‚å¸¸ã€‚</p>
<p>è¯»è€…æœ‹å‹ä»¬ï¼Œä½ ä»¬æ˜¯ä¸æ˜¯è§‰å¾—æˆ‘è·‘é¢˜äº†ï¼Œfail-fast å’Œ <code>for each</code> ä¸­é›†åˆçš„ remove æ“ä½œæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p>
<p>æœ‰ï¼Iterator ä½¿ç”¨äº† fail-fast çš„ä¿æŠ¤æœºåˆ¶ã€‚</p>
<h3 id="æ€ä¹ˆé¿å¼€-fail-fast-ä¿æŠ¤æœºåˆ¶å‘¢">04ã€æ€ä¹ˆé¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶å‘¢</h3>
<p>é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œç›¸ä¿¡å¤§å®¶éƒ½æ˜ç™½ä¸ºä»€ä¹ˆä¸èƒ½åœ¨ <code>for each</code> å¾ªç¯é‡Œè¿›è¡Œå…ƒç´ çš„ remove äº†ã€‚</p>
<p>é‚£æ€ä¹ˆé¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶å‘¢ï¼Ÿæ¯•ç«Ÿåˆ é™¤å…ƒç´ æ˜¯å¸¸è§„æ“ä½œï¼Œå’±ä¸èƒ½å› å™åºŸé£Ÿå•Šã€‚</p>
<p>1ï¼‰remove å break</p>
<pre><code><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);

for (String str : list) {
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        list.remove(str);
        break;
    }
}</code></code></pre>
<p>æˆ‘æ€ä¹ˆè¿™ä¹ˆèªæ˜ï¼Œå¿ä¸ä½éª„å‚²ä¸€ä¸‹ã€‚æœ‰è¯»è€…ä¸æ˜ç™½ä¸ºä»€ä¹ˆå—ï¼Ÿé‚£æˆ‘ä¸Šé¢çš„æºç åˆ†æå¯å°±ç™½åˆ†æäº†ï¼Œçˆ¬æ¥¼å†çœ‹ä¸€éå§ï¼</p>
<p>ç•¥å¾®é€éœ²ä¸€ä¸‹åŸå› ï¼šbreak åå¾ªç¯å°±ä¸å†éå†äº†ï¼Œæ„å‘³ç€ Iterator çš„ next æ–¹æ³•ä¸å†æ‰§è¡Œäº†ï¼Œä¹Ÿå°±æ„å‘³ç€ <code>checkForComodification</code> æ–¹æ³•ä¸å†æ‰§è¡Œäº†ï¼Œæ‰€ä»¥å¼‚å¸¸ä¹Ÿå°±ä¸ä¼šæŠ›å‡ºäº†ã€‚</p>
<p>ä½†æ˜¯å‘¢ï¼Œå½“ List ä¸­æœ‰é‡å¤å…ƒç´ è¦åˆ é™¤çš„æ—¶å€™ï¼Œbreak å°±ä¸åˆé€‚äº†ã€‚</p>
<p>2ï¼‰for å¾ªç¯</p>
<pre><code><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);
for (int i = 0, n = list.size(); i &lt; n; i++) {
    String str = list.get(i);
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        list.remove(str);
    }
}</code></code></pre>
<p>for å¾ªç¯è™½ç„¶å¯ä»¥é¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶ï¼Œä¹Ÿå°±è¯´ remove å…ƒç´ åä¸å†æŠ›å‡ºå¼‚å¸¸ï¼›ä½†æ˜¯å‘¢ï¼Œè¿™æ®µç¨‹åºåœ¨åŸåˆ™ä¸Šæ˜¯æœ‰é—®é¢˜çš„ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>ç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™ï¼Œi ä¸º 0ï¼Œ<code>list.size()</code> ä¸º 3ï¼Œå½“æ‰§è¡Œå®Œ remove æ–¹æ³•åï¼Œi ä¸º 1ï¼Œ<code>list.size()</code> å´å˜æˆäº† 2ï¼Œå› ä¸º list çš„å¤§å°åœ¨ remove åå‘ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿå°±æ„å‘³ç€â€œæ²‰é»˜ç‹ä¸‰â€è¿™ä¸ªå…ƒç´ è¢«è·³è¿‡äº†ã€‚èƒ½æ˜ç™½å—ï¼Ÿ</p>
<p>remove ä¹‹å‰ <code>list.get(1)</code> ä¸ºâ€œæ²‰é»˜ç‹ä¸‰â€ï¼›ä½† remove ä¹‹å <code>list.get(1)</code> å˜æˆäº†â€œä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜â€ï¼Œè€Œ <code>list.get(0)</code> å˜æˆäº†â€œæ²‰é»˜ç‹ä¸‰â€ã€‚</p>
<p>3ï¼‰Iterator</p>
<pre><code><code>List&lt;String&gt; list = new ArrayList&lt;&gt;();
list.add(&quot;æ²‰é»˜ç‹äºŒ&quot;);
list.add(&quot;æ²‰é»˜ç‹ä¸‰&quot;);
list.add(&quot;ä¸€ä¸ªæ–‡ç« çœŸç‰¹ä¹ˆæœ‰è¶£çš„ç¨‹åºå‘˜&quot;);

Iterator&lt;String&gt; itr = list.iterator();

while (itr.hasNext()) {
    String str = itr.next();
    if (&quot;æ²‰é»˜ç‹äºŒ&quot;.equals(str)) {
        itr.remove();
    }
}</code></code></pre>
<p>ä¸ºä»€ä¹ˆä½¿ç”¨ Iterator çš„ remove æ–¹æ³•å°±å¯ä»¥é¿å¼€ fail-fast ä¿æŠ¤æœºåˆ¶å‘¢ï¼Ÿçœ‹ä¸€ä¸‹ remove çš„æºç å°±æ˜ç™½äº†ã€‚</p>
<pre><code><code>public void remove() {
    if (lastRet &lt; 0)
        throw new IllegalStateException();
    checkForComodification();

    try {
        ArrayList.this.remove(lastRet);
        cursor = lastRet;
        lastRet = -1;
        expectedModCount = modCount;
    } catch (IndexOutOfBoundsException ex) {
        throw new ConcurrentModificationException();
    }
}</code></code></pre>
<p>è™½ç„¶åˆ é™¤å…ƒç´ ä¾ç„¶ä½¿ç”¨çš„æ˜¯ ArrayList çš„ remove æ–¹æ³•ï¼Œä½†æ˜¯åˆ é™¤å®Œä¼šæ‰§è¡Œ <code>expectedModCount = modCount</code>ï¼Œä¿è¯äº† expectedModCount ä¸ modCount çš„åŒæ­¥ã€‚</p>
<h3 id="æœ€å">05ã€æœ€å</h3>
<p>åœ¨ Java ä¸­ï¼Œfail-fast ä»ç‹­ä¹‰ä¸Šè®²æ˜¯é’ˆå¯¹å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„é›†åˆè¿­ä»£å™¨è€Œè¨€çš„ã€‚è¿™ä¸€ç‚¹å¯ä»¥ä» <code>ConcurrentModificationException</code> å®šä¹‰ä¸Šçœ‹å¾—å‡ºæ¥ã€‚</p>
<blockquote>
<p>This exception may be thrown by methods that have detected concurrent<br />
modification of an object when such modification is not permissible.<br><br />
For example, it is not generally permissible for one thread to modify a Collectionwhile another thread is iterating over it. In general, the results of theiteration are undefined under these circumstances. Some Iteratorimplementations (including those of all the general purpose collection implementationsprovided by the JRE) may choose to throw this exception if this behavior isdetected. Iterators that do this are known as fail-fast iterators,as they fail quickly and cleanly, rather that risking arbitrary,non-deterministic behavior at an undetermined time in the future.</p>
</blockquote>
<p>å†æ¬¡æ‹™åŠ£åœ°ç¿»è¯‘ä¸€ä¸‹ã€‚</p>
<p>è¯¥å¼‚å¸¸å¯èƒ½ç”±äºæ£€æµ‹åˆ°å¯¹è±¡åœ¨å¹¶å‘æƒ…å†µä¸‹è¢«ä¿®æ”¹è€ŒæŠ›å‡ºçš„ï¼Œè€Œè¿™ç§ä¿®æ”¹æ˜¯ä¸å…è®¸çš„ã€‚</p>
<p>é€šå¸¸ï¼Œè¿™ç§æ“ä½œæ˜¯ä¸å…è®¸çš„ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªçº¿ç¨‹åœ¨ä¿®æ”¹é›†åˆï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨è¿­ä»£å®ƒã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¿­ä»£çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚å¦‚æœæ£€æµ‹åˆ°è¿™ç§è¡Œä¸ºï¼Œä¸€äº› Iteratorï¼ˆæ¯”å¦‚è¯´ ArrayList çš„å†…éƒ¨ç±» Itrï¼‰å°±ä¼šé€‰æ‹©æŠ›å‡ºè¯¥å¼‚å¸¸ã€‚è¿™æ ·çš„è¿­ä»£å™¨è¢«ç§°ä¸º fail-fast è¿­ä»£å™¨ï¼Œå› ä¸ºå°½æ—©çš„å¤±è´¥æ¯”æœªæ¥å‡ºç°ä¸ç¡®å®šçš„é£é™©æ›´å¥½ã€‚</p>
<p>æ—¢ç„¶æ˜¯é’ˆå¯¹å¤šçº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬ä¹‹å‰çš„åˆ†æéƒ½æ˜¯åŸºäºå•çº¿ç¨‹çš„å‘¢ï¼Ÿå› ä¸ºä»å¹¿ä¹‰ä¸Šè®²ï¼Œfail-fast æŒ‡çš„æ˜¯å½“æœ‰å¼‚å¸¸æˆ–è€…é”™è¯¯å‘ç”Ÿæ—¶å°±ç«‹å³ä¸­æ–­æ‰§è¡Œçš„è¿™ç§è®¾è®¡ï¼Œä»å•çº¿ç¨‹çš„è§’åº¦å»åˆ†æï¼Œå¤§å®¶æ›´å®¹æ˜“æ˜ç™½ã€‚</p>
<p>ä½ è¯´å¯¹å—ï¼Ÿ</p>
<h3 id="è‡´è°¢">06ã€è‡´è°¢</h3>
<p>è°¢è°¢å¤§å®¶çš„é˜…è¯»ï¼ŒåŸåˆ›ä¸æ˜“ï¼Œå–œæ¬¢å°±éšæ‰‹ç‚¹ä¸ªèµğŸ‘ï¼Œè¿™å°†æ˜¯æˆ‘æœ€å¼ºçš„å†™ä½œåŠ¨åŠ›ã€‚</p>


</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>